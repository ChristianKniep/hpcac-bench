---
- hosts: all
  remote_user: root
  vars:
    docker_socket: tcp://0.0.0.0:6000
    docker_data: /var/lib/docker/
  tasks:
  - include: tasks/base_setup.yaml
  - include: tasks/basic_pkg.yml
  - include: tasks/users.yml
  - include: tasks/docker.yml
  - include: tasks/cluster_env.yml
  - include: tasks/setup_monitoring.yml
  - include: tasks/setup_supervisord.yml
  - include: tasks/setup_slurm.yml
  handlers:
  - include: handlers/services.yml
  
- hosts: master
  remote_user: root
  tasks:
  - include: tasks/create_mfiles.yml
  #- include: tasks/nfs.yml
  #- include: tasks/start_reg.yml
  - include: tasks/compile_hpcc.yml

- hosts: docker-server
  remote_user: root
  tasks:
  - include: tasks/start_reg.yml

- hosts: clients
  remote_user: root
  vars:
  tasks:
  #- include: tasks/nfs-clients.yml nfsserver={{ groups.master[0] }} nfspath=/opt/nfs/chome nfsmount=/chome
  #- include: tasks/nfs-clients.yml nfsserver={{ groups.master[0] }} nfspath=/opt/nfs/scratch nfsmount=/scratch
  #- include: tasks/users.yml
